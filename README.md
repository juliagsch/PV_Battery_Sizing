# Fast Optimal Sizing of Domestic PV Energy Systems

## Overview

This project provides a framework for rapidly determining the optimal sizing of battery and photovoltaic (PV) systems for residential applications. It automates the process of fetching and processing load and solar irradiance data, creating a labeled dataset and training a machine learning model for fast sizing predictions.

## Project Workflow

The project follows these key steps:

1.  **Data Acquisition:** Obtaining hourly load and solar generation data over a one-year period.
2.  **Data Preparation:** Cleaning, processing, and augmenting the raw data to create a comprehensive dataset.
3.  **Optimal Sizing Labeling:** Utilizing a simulation tool to calculate the optimal battery and PV sizes for each combination of load and solar profiles.
4.  **Dataset Management:** Splitting, merging, interleaving, and filtering the labeled data.
5.  **Model Training:** Training an MLP to predict optimal sizing based on load and solar data.

## Data Preparation Details

### Load Data

The process for acquiring and preparing household electricity load data involves the following steps:

1.  **Fetching Load Traces:** The `data/load/fetch_load.py` script is used to retrieve load data from the Faraday dataset [1]. This script fetches data for 1000 households for each day of the year.
2.  **Processing Raw Data:** The raw responses from Faraday are then processed by `data/load/prepare_inputs.py` to generate hourly load profiles spanning one year for each household.
3.  **Data Augmentation:** To increase the size and robustness of the dataset, `data/load/add_noisy_data.py` adds noise to the original load traces to increase variation and grow the datset.

### Solar Data

The process for acquiring and preparing solar photovoltaic generation data involves the following steps:

1.  **Fetching Solar Traces:** The `data/solar/fetch_solar.py` script retrieves hourly solar irradiance data using the PVWatts API [2].
2.  **Processing PVWatts Data:** The raw data from PVWatts is processed by `data/solar/process_inputs.py` to obtain usable hourly solar generation profiles.
3.  **Data Augmentation:** Similar to the load data, `data/solar/add_noisy_data.py` augments the original solar traces to expand the dataset.

### Data Verification

To ensure the quality and representativeness of the generated data, the following visualization tools are provided:

* `data/plot.py`: This script allows for plotting the generated load and solar traces at different time resolutions (hourly, daily, or monthly).
* `data/solar/plot_map.py`: This script visualizes the geographical locations for which solar traces were obtained on a map, providing insight into the spatial distribution of the data.

### Optimal Sizing Labeling

The core of the dataset creation involves determining the optimal battery and PV system sizes for each load and solar profile. This is achieved through the following steps:

1.  **Data Splitting:** The generated load and solar data are divided into training and testing sets using a 90/10 ratio. The specific files included in each split are recorded in `dataset/test_load.txt`, `dataset/train_load.txt`, `dataset/test_solar.txt`, and `dataset/train_solar.txt` for Reproducibility.
2.  **Data Combination and Labeling:** Within the training and testing splits, each load trace is paired with three randomly selected solar traces. For each of these combinations, the optimal PV and battery sizes are computed using the Robust Sizing Simulator developed by Brad Huang [3].
3.  **Dataset Management Utilities:**
    * `dataset/merge_data.py`: This script allows for merging datasets if new data is generated by re-running the data preparation and labeling steps. It can also interleave the solar and load traces to arrange the data chronologically.
    * `dataset/threshold.py`: This script provides functionality to filter out data samples with unrealistic or outlier sizing recommendations, ensuring the quality of the training data.

## Model Training

The `model/train.py` script is used to train a Multi-Layer Perceptron (MLP) model using the labeled dataset created in the previous steps. This trained model can then be used for fast predictions of optimal PV and battery sizing for new, unseen load and solar profiles.

## Sources

[1] Faraday: [https://www.centrefornetzero.org/technologies/faraday](https://www.centrefornetzero.org/technologies/faraday)
[2] PVWatts: [https://pvwatts.nrel.gov/pvwatts.php](https://pvwatts.nrel.gov/pvwatts.php)
[3] Robust Sizing Simulator: [https://github.com/BradHuang1999/Robust-Sizing/tree/master](https://github.com/BradHuang1999/Robust-Sizing/tree/master)